"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[420],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},h="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),h=p(a),u=r,m=h["".concat(s,".").concat(u)]||h[u]||d[u]||i;return a?n.createElement(m,l(l({ref:t},c),{},{components:a})):n.createElement(m,l({ref:t},c))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=u;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[h]="string"==typeof e?e:r,l[1]=o;for(var p=2;p<i;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},5071:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const i={sidebar_position:2,title:"\ud83d\udea2 Release a Code Push App",description:"Release a Code Push App"},l="Releasing a code push app",o={unversionedId:"guides/code_push_release",id:"guides/code_push_release",title:"\ud83d\udea2 Release a Code Push App",description:"Release a Code Push App",source:"@site/docs/guides/code_push_release.md",sourceDirName:"guides",slug:"/guides/code_push_release",permalink:"/guides/code_push_release",draft:!1,editUrl:"https://github.com/shorebirdtech/docs/tree/main/docs/guides/code_push_release.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"\ud83d\udea2 Release a Code Push App",description:"Release a Code Push App"},sidebar:"tutorialSidebar",previous:{title:"\u2604\ufe0f Code Push Quickstart",permalink:"/guides/code_push_quickstart"},next:{title:"\ud83d\udee4\ufe0f Multiple Deployment Tracks",permalink:"/guides/multiple_deployment_tracks"}},s={},p=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Creating a release",id:"creating-a-release",level:2},{value:"Determine next release version",id:"determine-next-release-version",level:3},{value:"Make code changes",id:"make-code-changes",level:3},{value:"Update app version",id:"update-app-version",level:3},{value:"Create a Shorebird release",id:"create-a-shorebird-release",level:3},{value:"Upload to the Play Store",id:"upload-to-the-play-store",level:3},{value:"Create a GitHub release",id:"create-a-github-release",level:3},{value:"After the release is approved",id:"after-the-release-is-approved",level:2},{value:"Creating a patch",id:"creating-a-patch",level:2},{value:"Make the change",id:"make-the-change",level:3},{value:"Create a Shorebird patch",id:"create-a-shorebird-patch",level:3},{value:"Cleanup",id:"cleanup",level:3}],c={toc:p},h="wrapper";function d(e){let{components:t,...a}=e;return(0,r.kt)(h,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"releasing-a-code-push-app"},"Releasing a code push app"),(0,r.kt)("p",null,"This guide walks through releasing a code push app to the Play Store and applying a patch to that release."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"This guide assumes that you have an existing Shorebird app. If you don't have one, you can create one by following the ",(0,r.kt)("a",{parentName:"p",href:"./code_push_quickstart/"},"code push quickstart")," guide."),(0,r.kt)("p",null,"The app we will be releasing in this guide is ",(0,r.kt)("a",{parentName:"p",href:"https://play.google.com/store/apps/details?id=dev.shorebird.u_shorebird_clock"},(0,r.kt)("inlineCode",{parentName:"a"},"Time Shift")),", our demo code push app. (",(0,r.kt)("a",{parentName:"p",href:"https://github.com/shorebirdtech/time_shift/"},"source"),")"),(0,r.kt)("h2",{id:"creating-a-release"},"Creating a release"),(0,r.kt)("h3",{id:"determine-next-release-version"},"Determine next release version"),(0,r.kt)("p",null,"Start by running ",(0,r.kt)("inlineCode",{parentName:"p"},"shorebird releases list")," to see the current set of releases:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"bryanoltman@boltman ~/Shorebird/time_shift (main)\n\u2446 shorebird releases list\n\ud83d\ude80 Releases (51751336-6a7c-4972-b4ec-8fc1591fb2b3)\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Version \u2502 Name \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 1.0.1   \u2502 --   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 1.0.2+1 \u2502 --   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 1.0.2+5 \u2502 --   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,r.kt)("p",null,"This shows that the most recent release is ",(0,r.kt)("inlineCode",{parentName:"p"},"1.0.2+5"),". This corresponds with what we see in the Play Store console:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://github.com/shorebirdtech/docs/assets/581764/e6b6c276-49de-4142-8f32-dbf5e41379fa",alt:"ReleaseVersion"})),(0,r.kt)("p",null,"Next, we'll create a new release for version ",(0,r.kt)("inlineCode",{parentName:"p"},"1.0.3+6"),"."),(0,r.kt)("h3",{id:"make-code-changes"},"Make code changes"),(0,r.kt)("p",null,"Version ",(0,r.kt)("inlineCode",{parentName:"p"},"1.0.3+6")," of Time Shift will change the default clock face from ",(0,r.kt)("inlineCode",{parentName:"p"},"particle")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"generative"),"."),(0,r.kt)("p",null,"To make this change, edit ",(0,r.kt)("inlineCode",{parentName:"p"},"lib/main.dart"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},"   final clock = ClockFace.values.firstWhere(\n     (clock) => clock.name == clockName,\n-    orElse: () => ClockFace.particle,\n+    orElse: () => ClockFace.generative,\n   );\n")),(0,r.kt)("p",null,"Verify that this change does what we expect by running the app with ",(0,r.kt)("inlineCode",{parentName:"p"},"shorebird run"),"."),(0,r.kt)("p",null,"Once this change has been verified, commit this change and push it to GitHub:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'git add lib/main.dart\ngit commit -m "Change default clock face to generative"\ngit push\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/shorebirdtech/time_shift/commit/d1fe9451aa18a775163bce95dd9dab551aaf6259"},"On GitHub")),(0,r.kt)("h3",{id:"update-app-version"},"Update app version"),(0,r.kt)("p",null,"Next, bump the app version in ",(0,r.kt)("inlineCode",{parentName:"p"},"pubspec.yaml"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},'name: time_shift\ndescription: Demo app showing Shorebird updates.\npublish_to: "none"\n\n-version: 1.0.2+5\n+version: 1.0.3+6\n\nenvironment:\n  sdk: ">=2.19.4 <3.0.0"\n')),(0,r.kt)("p",null,"Commit, tag, and push the change."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'git add pubspec.yaml\ngit commit -m "Update app version to 1.0.3+6"\ngit tag v1.0.3+6\ngit push # Push the commit\ngit push --tags  # Push the tag\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/shorebirdtech/time_shift/commit/3b25df1888c170c2418162ba64a9a5e6363c09af"},"On GitHub")),(0,r.kt)("h3",{id:"create-a-shorebird-release"},"Create a Shorebird release"),(0,r.kt)("p",null,"To create a Shorebird release, run ",(0,r.kt)("inlineCode",{parentName:"p"},"shorebird release android"),". You should see output similar to the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"bryanoltman@boltman ~/Shorebird/time_shift (main)\n\u2446 shorebird release android\n\u2713 Building release (17.0s)\n\u2713 Fetching apps (0.3s)\n\u2713 Detecting release version (0.2s)\n\n\ud83d\ude80 Ready to create a new release!\n\n\ud83d\udcf1 App: time_shift (51751336-6a7c-4972-b4ec-8fc1591fb2b3)\n\ud83d\udce6 Release Version: 1.0.3+6\n\ud83d\udd79\ufe0f Platform: android (arm64, arm32, x86_64)\n\nWould you like to continue? (y/N) Yes\n\u2713 Fetching releases (70ms)\n\u2713 Fetching Flutter revision (22ms)\n\u2713 Creating release (61ms)\n\u2713 Creating artifacts (2.5s)\n\n\u2705 Published Release!\n\nYour next step is to upload the app bundle to the Play Store.\n./build/app/outputs/bundle/release/app-release.aab\n\nSee the following link for more information:\nhttps://support.google.com/googleplay/android-developer/answer/9859152?hl=en\n")),(0,r.kt)("h3",{id:"upload-to-the-play-store"},"Upload to the Play Store"),(0,r.kt)("p",null,"As per the instructions above, we must upload the generated ",(0,r.kt)("inlineCode",{parentName:"p"},".aab")," to the Play Store."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Navigate to the ",(0,r.kt)("a",{parentName:"li",href:"https://play.google.com/console/developers"},"Play Console"),"."),(0,r.kt)("li",{parentName:"ol"},"Choose your developer account (for us, it's Shorebirdbird.dev)."),(0,r.kt)("li",{parentName:"ol"},"Select the Time Shift app."),(0,r.kt)("li",{parentName:"ol"},'Select "Testing -> Open Testing" from the side bar.'),(0,r.kt)("li",{parentName:"ol"},'Click the "Create new release" button.')),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://github.com/shorebirdtech/docs/assets/581764/90c9c7ed-bc39-4731-bfec-524f89e2baf6",alt:"CreateNewRelease"})),(0,r.kt)("p",null,"Upload the ",(0,r.kt)("inlineCode",{parentName:"p"},".aab")," file located at ",(0,r.kt)("inlineCode",{parentName:"p"},"./build/app/outputs/bundle/release/app-release.aab"),"."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"From the root directory of the project, run ",(0,r.kt)("inlineCode",{parentName:"li"},"open ./build/app/outputs/bundle/release/")," to open the folder containing the ",(0,r.kt)("inlineCode",{parentName:"li"},".aab")," in Finder."),(0,r.kt)("li",{parentName:"ol"},"Drag ",(0,r.kt)("inlineCode",{parentName:"li"},"app-release.aab")," into the Play Console to upload.")),(0,r.kt)("p",null,"Once the upload completes, the Play Store will correctly recognize the new version as ",(0,r.kt)("inlineCode",{parentName:"p"},"6 (1.0.3)"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://github.com/shorebirdtech/docs/assets/581764/1994cb5a-4cd6-4f1b-a88c-f5aaa3d1433d",alt:"UploadedBundle"})),(0,r.kt)("p",null,'Click "Next" and then "Save" (both in the bottom-right corner) to submit.'),(0,r.kt)("p",null,'This will take you to the publishing overview page. Click "Submit for review" to submit the release for review.'),(0,r.kt)("p",null,'You should now see a release in the Play Store console with an "In review" status:'),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://github.com/shorebirdtech/docs/assets/581764/4cfdc7fb-2049-4110-b1cd-da99c7a491f7",alt:"InReview"})),(0,r.kt)("p",null,"Now you must wait for the Play Store to approve the release."),(0,r.kt)("h3",{id:"create-a-github-release"},"Create a GitHub release"),(0,r.kt)("p",null,"It's recommended to create a GitHub release as well."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Navigate to ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/shorebirdtech/time_shift/releases"},"https://github.com/shorebirdtech/time_shift/releases"),"."),(0,r.kt)("li",{parentName:"ol"},'Click "Draft a new release".'),(0,r.kt)("li",{parentName:"ol"},"Choose the tag we created earlier (",(0,r.kt)("inlineCode",{parentName:"li"},"v1.0.3+6"),")."),(0,r.kt)("li",{parentName:"ol"},'Title the release "v1.0.3+6".'),(0,r.kt)("li",{parentName:"ol"},"Add a description of the release (\"Changes the default clock face to 'generative'\")."),(0,r.kt)("li",{parentName:"ol"},"Publish the release.")),(0,r.kt)("h2",{id:"after-the-release-is-approved"},"After the release is approved"),(0,r.kt)("p",null,"Once the release has been approved, you will be able to download it from the Play Store."),(0,r.kt)("h2",{id:"creating-a-patch"},"Creating a patch"),(0,r.kt)("p",null,"Patches can be pushed to fix bugs in the ",(0,r.kt)("inlineCode",{parentName:"p"},"1.0.3+6")," release without requiring a new submission to the Play Store."),(0,r.kt)("h3",{id:"make-the-change"},"Make the change"),(0,r.kt)("p",null,"Start by checking out the ",(0,r.kt)("inlineCode",{parentName:"p"},"v1.0.3+6")," release tag:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"git checkout v1.0.3+6\n")),(0,r.kt)("p",null,"Next, create a branch, as this change will represent a divergence from the ",(0,r.kt)("inlineCode",{parentName:"p"},"main")," branch:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"git checkout -b v1.0.3+6-patch1\n")),(0,r.kt)("p",null,"For the purposes of this guide, we will change the default clock face back to ",(0,r.kt)("inlineCode",{parentName:"p"},"particle")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"lib/main.dart"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},"     (clock) => clock.name == clockName,\n-    orElse: () => ClockFace.generative,\n+    orElse: () => ClockFace.particle,\n   );\n")),(0,r.kt)("p",null,"Commit the change and push our new patch branch:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'git add lib/main.dart\ngit commit -m "Change default clock face to particle"\ngit push --set-upstream origin v1.0.3+6-patch1\n')),(0,r.kt)("p",null,"Tag this commit as ",(0,r.kt)("inlineCode",{parentName:"p"},"v1.0.3+6-patch1"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"git tag v1.0.3+6-patch1\ngit push --tags\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/shorebirdtech/time_shift/commit/cf4054bada74ff1c5ff84fb9aceb3f1e4442203f"},"On GitHub")),(0,r.kt)("h3",{id:"create-a-shorebird-patch"},"Create a Shorebird patch"),(0,r.kt)("p",null,"Finally, push the patch with ",(0,r.kt)("inlineCode",{parentName:"p"},"shorebird patch android"),". You should see output similar to the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"bryanoltman@boltman ~/Shorebird/time_shift (main)\n\u2446 shorebird patch android\n\u2713 Building patch (17.2s)\n\u2713 Fetching apps (0.7s)\n\u2713 Detecting release version (0.2s)\n\u2713 Fetching release (99ms)\n\u2713 Fetching Flutter revision (13ms)\n\u2713 Fetching release artifacts (0.2s)\n\u2713 Downloading release artifacts (1.0s)\n\u2713 Creating artifacts (1.0s)\n\n\ud83d\ude80 Ready to publish a new patch!\n\n\ud83d\udcf1 App: time_shift (51751336-6a7c-4972-b4ec-8fc1591fb2b3)\n\ud83d\udce6 Release Version: 1.0.3+6\n\ud83d\udcfa Channel: stable\n\ud83d\udd79\ufe0f  Platform: android [arm64 (135 B), arm32 (150 B), x86_64 (135 B)]\n\nWould you like to continue? (y/N) Yes\n\u2713 Creating patch (0.1s)\n\u2713 Uploading artifacts (0.9s)\n\u2713 Fetching channels (90ms)\n\u2713 Promoting patch to stable (61ms)\n\n\u2705 Published Patch!\n")),(0,r.kt)("p",null,"This patch will now be available to users with version ",(0,r.kt)("inlineCode",{parentName:"p"},"1.0.3+6")," of the app."),(0,r.kt)("h3",{id:"cleanup"},"Cleanup"),(0,r.kt)("p",null,"Delete the branch to keep the repository tidy:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"git checkout main\ngit branch -D v1.0.3+6-patch1\ngit push origin --delete v1.0.3+6-patch1\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Note: this change is still accessible via the ",(0,r.kt)("inlineCode",{parentName:"p"},"v1.0.3+6-patch1")," tag.")))}d.isMDXComponent=!0}}]);